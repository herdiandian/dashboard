<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard Buku Tamu</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- DataTables CSS -->
  <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">

  <style>
    /* Hover effect like Bootstrap button */
    #checkInCard {
      cursor: pointer;
      transition: background-color 0.2s ease-in-out;
    }
    #checkInCard:hover {
      background-color: #0dcaf0 !important; /* bootstrap info hover */
      opacity: 0.9;
    }
  </style>
</head>
<body class="bg-light">

<div class="container py-4">
  <h1 class="text-center mb-4">Dashboard Buku Tamu</h1>

  <!-- Stats Cards -->
  <div class="row g-3 mb-4">
    <div class="col-6 col-md-6">
      <div class="card text-center text-white bg-info shadow-sm" id="checkInCard">
        <div class="card-body">
          <h5>Check In</h5>
          <h2>
            <span id="checkedIn" class="fw-bold m-2">0</span>
            <span class="text-primary">
              /
              <span id="totalData" class="m-2">0</span>
            </span>
          </h2>
        </div>
      </div>
    </div>
    <div class="col-6 col-md-6">
      <div class="card text-center text-white bg-warning shadow-sm">
        <div class="card-body">
          <h5>Non QRCode</h5>
          <h2 id="checkedManual">0</h2>
        </div>
      </div>
    </div>
  </div>

  <!-- DataTable Section -->
  <div class="card shadow-sm">
    <div class="card-body">
      <table id="bukuTamuTable" class="table table-striped table-bordered align-middle" style="width:100%">
        <thead class="table-light">
          <tr>
            <!-- <th>No</th> -->
            <th>Name</th>
            <th>Asal</th>
            <th>Waktu</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<script>
  const sheetUrl = "https://opensheet.elk.sh/1x8T1tO440ulOLdWaD4rc_0MnJcKr4BDSM2d96FsRKpA/";
  
  let dataTable;
  let masterDataTotal = 0;
  
  // Load Master Data once
  async function loadMasterData() {
    const resMasterData = await fetch(sheetUrl + "Master+Data");
    const masterData = await resMasterData.json();
    masterDataTotal = masterData.length;
    document.getElementById("totalData").innerText = masterDataTotal;
  }
  
  // Load Buku Tamu repeatedly
  async function loadBukuTamu() {
    const res = await fetch(sheetUrl + "Buku+Tamu");
    let data = await res.json();
  
    // Stats
    const checkedIn = data.length;
    const checkedInManual = data.filter(r => r.id && r.id.toLowerCase() === "manual").length;
  
    document.getElementById("checkedIn").innerText = checkedIn;
    document.getElementById("checkedManual").innerText = checkedInManual;
  
    // ðŸ”¹ Sort data by "date" (descending) BEFORE formatting
    data.sort((a, b) => new Date(b.date) - new Date(a.date));
  
    // Format waktu (HH:mm only)
    data.forEach(r => {
      if (r.date) {
        const d = new Date(r.date);
        if (!isNaN(d.getTime())) {
          r.date = d.toLocaleTimeString("id-ID", { hour: "2-digit", minute: "2-digit" });
        }
      }
    });
  
    // Reload DataTable
    const rows = data.map((row, i) => [
      // i + 1,
      row.Nama || "-",
      row.Asal || "-",
      row.date || "-"
    ]);
  
    if (dataTable) {
      dataTable.clear();
      dataTable.rows.add(rows);
      // dataTable.draw(false); // false biar gak reset paging
    } else {
      dataTable = $('#bukuTamuTable').DataTable({
        data: rows,
        // paging: false,
        // searching: false,
        lengthChange: false,
        language: {
            search: "", // Remove the "Search" label
            searchPlaceholder: "cari.. ." // Change the placeholder text
        },
        info: false,
        ordering: false,   // ðŸš€ Disable all column sorting
      });
    }
  }
  
  // Redirect when card is clicked
  document.getElementById("checkInCard").addEventListener("click", () => {
    window.open("https://herdiandian.github.io/checkin/", "_blank");
  });
  
  // Init
  loadMasterData();
  loadBukuTamu();
  setInterval(loadBukuTamu, 5000); // Auto reload only Buku Tamu
</script>
  

</body>
</html>


